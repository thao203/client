{"ast":null,"code":"import classNames from'classnames/bind';import styles from'./ForgotPassword.module.scss';import TextField from'@mui/material/TextField';import Button from'@mui/material/Button';import{useEffect,useState}from'react';import{Link,useNavigate}from'react-router-dom';import{toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import request from'../../config/Connect';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const cx=classNames.bind(styles);function ForgotPassword(){const[masinhvien,setMasinhvien]=useState('');const[email,setEmail]=useState('');const[checkStatus,setCheckStatus]=useState(false);const[otp,setOtp]=useState('');const[newPassword,setNewPassword]=useState('');const[isLoading,setIsLoading]=useState(false);const[errorMessage,setErrorMessage]=useState('');const navigate=useNavigate();useEffect(()=>{document.title=\"Quên mật khẩu\";},[]);const handleSubmit=async()=>{setIsLoading(true);setErrorMessage('');try{const res=await request.post('/api/sendOTP',{masinhvien,email});if(res.status===200){setCheckStatus(true);toast.success('OTP đã được gửi đến email của bạn!');}else{setErrorMessage('Lỗi khi gửi OTP, vui lòng thử lại!');}}catch(error){var _error$response,_error$response$data;const errorMsg=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Không thể gửi yêu cầu, kiểm tra lại mã sinh viên và email!';setErrorMessage(errorMsg);console.error('Error:',error);// Log lỗi\n}setIsLoading(false);};const handleChangePass=async()=>{setIsLoading(true);setErrorMessage('');try{const res=await request.post('/api/verifyOTP',{masinhvien,otp,newPassword});if(res.status===200){toast.success('Đổi mật khẩu thành công!',{autoClose:1000});window.location.href='/';}else{setErrorMessage('OTP không hợp lệ hoặc đã hết hạn!');}}catch(error){var _error$response2,_error$response2$data;const errorMsg=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Lỗi khi đổi mật khẩu, vui lòng thử lại!';setErrorMessage(errorMsg);console.error('Error:',error);}setIsLoading(false);};return/*#__PURE__*/_jsx(\"div\",{className:cx('wrapper'),children:/*#__PURE__*/_jsxs(\"div\",{className:cx('inner'),children:[errorMessage&&/*#__PURE__*/_jsx(\"p\",{className:cx('error'),children:errorMessage}),!checkStatus?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Qu\\xEAn m\\u1EADt kh\\u1EA9u?\"}),/*#__PURE__*/_jsxs(\"div\",{className:cx('input-group'),children:[/*#__PURE__*/_jsx(TextField,{label:\"M\\xE3 Sinh Vi\\xEAn\",variant:\"outlined\",size:\"medium\",fullWidth:true,value:masinhvien,onChange:e=>setMasinhvien(e.target.value)}),/*#__PURE__*/_jsx(TextField,{label:\"Email\",variant:\"outlined\",size:\"medium\",fullWidth:true,value:email,onChange:e=>setEmail(e.target.value)})]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",size:\"large\",fullWidth:true,onClick:handleSubmit,className:cx('submit-button'),disabled:isLoading,children:isLoading?'Đang gửi...':'Gửi yêu cầu khôi phục'}),/*#__PURE__*/_jsx(\"div\",{style:{paddingTop:'20px'},children:/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"\\u0110\\u0103ng Nh\\u1EADp\"})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"M\\u1EADt Kh\\u1EA9u M\\u1EDBi\"}),/*#__PURE__*/_jsxs(\"div\",{className:cx('input-group'),children:[/*#__PURE__*/_jsx(TextField,{label:\"Nh\\u1EADp M\\u1EADt Kh\\u1EA9u M\\u1EDBi\",variant:\"outlined\",size:\"medium\",fullWidth:true,type:\"password\",value:newPassword,onChange:e=>setNewPassword(e.target.value)}),/*#__PURE__*/_jsx(TextField,{label:\"OTP C\\u1EE7a B\\u1EA1n\",variant:\"outlined\",size:\"medium\",fullWidth:true,value:otp,onChange:e=>setOtp(e.target.value)})]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",size:\"large\",fullWidth:true,onClick:handleChangePass,className:cx('submit-button'),disabled:isLoading,children:isLoading?'Đang xử lý...':'Thay Đổi Mật Khẩu'}),/*#__PURE__*/_jsx(\"div\",{style:{paddingTop:'20px'},children:/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"\\u0110\\u0103ng Nh\\u1EADp\"})})]})]})});}export default ForgotPassword;","map":{"version":3,"names":["classNames","styles","TextField","Button","useEffect","useState","Link","useNavigate","toast","request","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","cx","bind","ForgotPassword","masinhvien","setMasinhvien","email","setEmail","checkStatus","setCheckStatus","otp","setOtp","newPassword","setNewPassword","isLoading","setIsLoading","errorMessage","setErrorMessage","navigate","document","title","handleSubmit","res","post","status","success","error","_error$response","_error$response$data","errorMsg","response","data","message","console","handleChangePass","autoClose","window","location","href","_error$response2","_error$response2$data","className","children","label","variant","size","fullWidth","value","onChange","e","target","color","onClick","disabled","style","paddingTop","to","type"],"sources":["E:/Documents/Hoc_Tap/LATN/client/src/Page/Forgetpassword/forgetpassword.js"],"sourcesContent":["import classNames from 'classnames/bind';\r\nimport styles from './ForgotPassword.module.scss';\r\nimport TextField from '@mui/material/TextField';\r\nimport Button from '@mui/material/Button';\r\nimport { useEffect, useState } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { toast } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport request from '../../config/Connect';\r\n\r\nconst cx = classNames.bind(styles);\r\n\r\nfunction ForgotPassword() {\r\n    const [masinhvien, setMasinhvien] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [checkStatus, setCheckStatus] = useState(false);\r\n    const [otp, setOtp] = useState('');\r\n    const [newPassword, setNewPassword] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [errorMessage, setErrorMessage] = useState('');\r\n\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        document.title = \"Quên mật khẩu\";\r\n    }, []);\r\n\r\n    const handleSubmit = async () => {\r\n        setIsLoading(true);\r\n        setErrorMessage('');\r\n        try {\r\n            const res = await request.post('/api/sendOTP', { masinhvien, email });\r\n            if (res.status === 200) {\r\n                setCheckStatus(true);\r\n                toast.success('OTP đã được gửi đến email của bạn!');\r\n            } else {\r\n                setErrorMessage('Lỗi khi gửi OTP, vui lòng thử lại!');\r\n            }\r\n        } catch (error) {\r\n            const errorMsg = error.response?.data?.message || 'Không thể gửi yêu cầu, kiểm tra lại mã sinh viên và email!';\r\n            setErrorMessage(errorMsg);\r\n            console.error('Error:', error); // Log lỗi\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n    const handleChangePass = async () => {\r\n        setIsLoading(true);\r\n        setErrorMessage('');\r\n        try {\r\n            const res = await request.post('/api/verifyOTP', { masinhvien, otp, newPassword });\r\n            if (res.status === 200) {\r\n                toast.success('Đổi mật khẩu thành công!', { autoClose: 1000 }    );\r\n                window.location.href = '/';\r\n            } else {\r\n                setErrorMessage('OTP không hợp lệ hoặc đã hết hạn!');\r\n            }\r\n        } catch (error) {\r\n            const errorMsg = error.response?.data?.message || 'Lỗi khi đổi mật khẩu, vui lòng thử lại!';\r\n            setErrorMessage(errorMsg);\r\n            console.error('Error:', error);\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n    return (\r\n        <div className={cx('wrapper')}>\r\n            <div className={cx('inner')}>\r\n                {errorMessage && <p className={cx('error')}>{errorMessage}</p>}\r\n                {!checkStatus ? (\r\n                    <>\r\n                        <h2>Quên mật khẩu?</h2>\r\n                        <div className={cx('input-group')}>\r\n                            <TextField\r\n                                label=\"Mã Sinh Viên\"\r\n                                variant=\"outlined\"\r\n                                size=\"medium\"\r\n                                fullWidth\r\n                                value={masinhvien}\r\n                                onChange={(e) => setMasinhvien(e.target.value)}\r\n                            />\r\n                            <TextField\r\n                                label=\"Email\"\r\n                                variant=\"outlined\"\r\n                                size=\"medium\"\r\n                                fullWidth\r\n                                value={email}\r\n                                onChange={(e) => setEmail(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            color=\"primary\"\r\n                            size=\"large\"\r\n                            fullWidth\r\n                            onClick={handleSubmit}\r\n                            className={cx('submit-button')}\r\n                            disabled={isLoading}\r\n                        >\r\n                            {isLoading ? 'Đang gửi...' : 'Gửi yêu cầu khôi phục'}\r\n                        </Button>\r\n                        <div style={{ paddingTop: '20px' }}>\r\n                            <Link to=\"/\">Đăng Nhập</Link>\r\n                        </div>\r\n                    </>\r\n                ) : (\r\n                    <>\r\n                        <h2>Mật Khẩu Mới</h2>\r\n                        <div className={cx('input-group')}>\r\n                            <TextField\r\n                                label=\"Nhập Mật Khẩu Mới\"\r\n                                variant=\"outlined\"\r\n                                size=\"medium\"\r\n                                fullWidth\r\n                                type=\"password\"\r\n                                value={newPassword}\r\n                                onChange={(e) => setNewPassword(e.target.value)}\r\n                            />\r\n                            <TextField\r\n                                label=\"OTP Của Bạn\"\r\n                                variant=\"outlined\"\r\n                                size=\"medium\"\r\n                                fullWidth\r\n                                value={otp}\r\n                                onChange={(e) => setOtp(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            color=\"primary\"\r\n                            size=\"large\"\r\n                            fullWidth\r\n                            onClick={handleChangePass}\r\n                            className={cx('submit-button')}\r\n                            disabled={isLoading}\r\n                        >\r\n                            {isLoading ? 'Đang xử lý...' : 'Thay Đổi Mật Khẩu'}\r\n                        </Button>\r\n                        <div style={{ paddingTop: '20px' }}>\r\n                            <Link to=\"/\">Đăng Nhập</Link>\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ForgotPassword;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}