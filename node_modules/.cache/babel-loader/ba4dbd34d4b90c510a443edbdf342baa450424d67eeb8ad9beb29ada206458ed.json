{"ast":null,"code":"import{useEffect,useState}from'react';import request from'../../../../config/Connect';import classNames from'classnames/bind';import styles from'./HandleBooks.module.scss';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faCheck,faTimes,faInfoCircle}from'@fortawesome/free-solid-svg-icons';import'bootstrap/dist/css/bootstrap.min.css';import{ToastContainer,toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import useDebounce from'../../../../customHook/useDebounce';import{Modal,Button}from'react-bootstrap';import ModalAddHandleBook from'../../../../Modal/ExtenBooks/ModalAddHandleBook';import Select from'react-select';import DatePicker from'react-datepicker';import'react-datepicker/dist/react-datepicker.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const cx=classNames.bind(styles);function HandleBook(){const[borrowedRecords,setBorrowedRecords]=useState([]);const[filteredRecords,setFilteredRecords]=useState([]);const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage]=useState(10);const[searchValue,setSearchValue]=useState('');const[showModal,setShowModal]=useState(false);const[selectedRecord,setSelectedRecord]=useState(null);const[isLoading,setIsLoading]=useState(false);const[showAddModal,setShowAddModal]=useState(false);const[showFilterForm,setShowFilterForm]=useState(false);const debounce=useDebounce(searchValue,500);// State cho bộ lọc\nconst[filterBorrowStartDate,setFilterBorrowStartDate]=useState(null);const[filterBorrowEndDate,setFilterBorrowEndDate]=useState(null);const[filterDueStartDate,setFilterDueStartDate]=useState(null);const[filterDueEndDate,setFilterDueEndDate]=useState(null);const[filterOverdue,setFilterOverdue]=useState(null);const[filterConfirmed,setFilterConfirmed]=useState(null);// Hàm format ngày\nconst formatDate=dateString=>{if(!dateString)return'N/A';try{const date=new Date(dateString);if(isNaN(date.getTime()))return'N/A';const day=String(date.getDate()).padStart(2,'0');const month=String(date.getMonth()+1).padStart(2,'0');const year=date.getFullYear();return`${day}/${month}/${year}`;}catch{return'N/A';}};// Hàm chuẩn hóa ngày\nconst normalizeDate=date=>{if(!date)return null;try{const year=date.getFullYear();const month=String(date.getMonth()+1).padStart(2,'0');const day=String(date.getDate()).padStart(2,'0');return`${year}-${month}-${day}`;}catch{return null;}};// Hàm tính số ngày quá hạn\nconst calculateOverdueDays=function(dueDate){let isReturned=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let savedOverdueDays=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(isReturned&&savedOverdueDays!==undefined){return savedOverdueDays;}if(!dueDate||isReturned)return 0;try{const today=new Date();const due=new Date(dueDate);today.setHours(0,0,0,0);due.setHours(0,0,0,0);const diffTime=today.getTime()-due.getTime();const diffDays=Math.floor(diffTime/(1000*60*60*24));return diffDays>0?diffDays:0;}catch{return 0;}};// Hàm tính tiền phạt\nconst calculateFine=(books,record)=>{const totalOverdueDays=books.reduce((total,book)=>{const dueDate=book.ngayhentra||record.ngayhentra;const overdueDays=calculateOverdueDays(dueDate,book.tinhtrang,book.overdueDays);return total+overdueDays;},0);return totalOverdueDays*2000;};// Hàm áp dụng bộ lọc hiện tại\nconst applyCurrentFilters=records=>{let filtered=[...records];if(filterBorrowStartDate){filtered=filtered.filter(record=>{const borrowDate=new Date(record.ngaymuon);const startDate=new Date(filterBorrowStartDate);return borrowDate>=startDate;});}if(filterBorrowEndDate){filtered=filtered.filter(record=>{const borrowDate=new Date(record.ngaymuon);const endDate=new Date(filterBorrowEndDate);return borrowDate<=endDate;});}if(filterDueStartDate){filtered=filtered.filter(record=>{const dueDate=new Date(record.ngayhentra);const startDate=new Date(filterDueStartDate);return dueDate>=startDate;});}if(filterDueEndDate){filtered=filtered.filter(record=>{const dueDate=new Date(record.ngayhentra);const endDate=new Date(filterDueEndDate);return dueDate<=endDate;});}if((filterOverdue===null||filterOverdue===void 0?void 0:filterOverdue.value)==='overdue'){filtered=filtered.filter(record=>record.books.some(book=>calculateOverdueDays(book.ngayhentra||record.ngayhentra,book.tinhtrang,book.overdueDays)>0));}else if((filterOverdue===null||filterOverdue===void 0?void 0:filterOverdue.value)==='notOverdue'){filtered=filtered.filter(record=>record.books.every(book=>calculateOverdueDays(book.ngayhentra||record.ngayhentra,book.tinhtrang,book.overdueDays)===0));}if((filterConfirmed===null||filterConfirmed===void 0?void 0:filterConfirmed.value)==='confirmed'){filtered=filtered.filter(record=>record.books.every(book=>book.confirm||book.tinhtrang));}else if((filterConfirmed===null||filterConfirmed===void 0?void 0:filterConfirmed.value)==='notConfirmed'){filtered=filtered.filter(record=>record.books.some(book=>!book.confirm&&!book.tinhtrang));}if(debounce.trim()){filtered=filtered.filter(record=>record.maphieumuon.toLowerCase().includes(debounce.toLowerCase())||record.masinhvien.toLowerCase().includes(debounce.toLowerCase()));}return filtered;};// Lấy danh sách phiếu mượn\nconst fetchBorrowedBooks=async()=>{setIsLoading(true);try{const response=await request.get('/api/GetBorrowedBooks');const data=Array.isArray(response.data)?response.data:[];const updatedData=data.map(record=>({...record,books:record.books.map(book=>{if(book.tinhtrang&&book.ngaytra){const dueDate=new Date(book.ngayhentra||record.ngayhentra);const returnDate=new Date(book.ngaytra);dueDate.setHours(0,0,0,0);returnDate.setHours(0,0,0,0);const diffTime=returnDate.getTime()-dueDate.getTime();const overdueDays=Math.floor(diffTime/(1000*60*60*24));return{...book,overdueDays:overdueDays>0?overdueDays:0};}return book;})}));setBorrowedRecords(updatedData);setFilteredRecords(applyCurrentFilters(updatedData));}catch(err){setBorrowedRecords([]);setFilteredRecords([]);toast.error('Lỗi khi tải danh sách phiếu mượn!');}finally{setIsLoading(false);}};// Hủy các phiếu mượn chưa xác nhận\nconst cancelUnconfirmedBorrows=async()=>{try{const response=await request.post('/api/cancelUnconfirmedBorrows');if(response.data.success){await fetchBorrowedBooks();}}catch(err){// Xử lý lỗi im lặng\n}};// Tìm kiếm phiếu mượn\nconst fetchSearchResults=async()=>{try{if(!debounce.trim()){setFilteredRecords(applyCurrentFilters(borrowedRecords));setCurrentPage(1);return;}const response=await request.post('/api/SearchBorrowRecords',{timphieu:debounce.trim()});const searchData=Array.isArray(response.data.data)?response.data.data:[];setFilteredRecords(applyCurrentFilters(searchData));setCurrentPage(1);}catch(err){setFilteredRecords([]);toast.error('Không tìm thấy phiếu mượn!');}};// Khởi tạo\nuseEffect(()=>{const initialize=async()=>{await cancelUnconfirmedBorrows();await fetchBorrowedBooks();};initialize();},[]);// Tìm kiếm khi debounce thay đổi\nuseEffect(()=>{fetchSearchResults();},[debounce]);// Điều chỉnh currentPage khi filteredRecords thay đổi\nuseEffect(()=>{const totalPages=Math.ceil(filteredRecords.length/itemsPerPage);if(currentPage>totalPages&&totalPages>0){setCurrentPage(totalPages);}},[filteredRecords,itemsPerPage,currentPage]);// Xử lý lọc phiếu mượn\nconst handleFilterSubmit=e=>{e.preventDefault();if(filterBorrowStartDate&&filterBorrowEndDate&&new Date(filterBorrowStartDate)>new Date(filterBorrowEndDate)){toast.error('Ngày mượn bắt đầu không được lớn hơn ngày kết thúc!');return;}if(filterDueStartDate&&filterDueEndDate&&new Date(filterDueStartDate)>new Date(filterDueEndDate)){toast.error('Ngày hẹn trả bắt đầu không được lớn hơn ngày kết thúc!');return;}setFilteredRecords(applyCurrentFilters(borrowedRecords));setShowFilterForm(false);};// Xóa bộ lọc\nconst handleFilterReset=()=>{setFilterBorrowStartDate(null);setFilterBorrowEndDate(null);setFilterDueStartDate(null);setFilterDueEndDate(null);setFilterOverdue(null);setFilterConfirmed(null);setFilteredRecords(borrowedRecords);setCurrentPage(1);setShowFilterForm(false);};// Xác nhận mượn sách\nconst handleConfirmBorrow=async(maphieumuon,masach)=>{setIsLoading(true);try{const response=await request.post('/api/confirmBorrowRequest',{maphieumuon,masach});if(response.status===200){const updatedRecords=borrowedRecords.map(record=>record.maphieumuon===maphieumuon?{...record,books:record.books.map(book=>book.masach===masach?{...book,confirm:true}:book)}:record);setBorrowedRecords(updatedRecords);setFilteredRecords(applyCurrentFilters(updatedRecords));toast.success('Xác nhận yêu cầu mượn sách thành công!');}}catch(err){var _err$response,_err$response$data;toast.error(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Lỗi khi xác nhận yêu cầu mượn!');}finally{setIsLoading(false);}};// Trả một sách\nconst handleReturnBook=async(maphieumuon,masach)=>{setIsLoading(true);const ngaytra=normalizeDate(new Date());try{const response=await request.post('/api/ReturnBook',{maphieumuon,masach,ngaytra});if(response.status===200){const updatedRecords=borrowedRecords.map(record=>record.maphieumuon===maphieumuon?{...record,books:record.books.map(book=>{if(book.masach===masach){const dueDate=book.ngayhentra||record.ngayhentra;const returnDate=new Date(ngaytra);const due=new Date(dueDate);returnDate.setHours(0,0,0,0);due.setHours(0,0,0,0);const diffTime=returnDate.getTime()-due.getTime();const overdueDays=Math.floor(diffTime/(1000*60*60*24));const finalOverdueDays=overdueDays>0?overdueDays:0;return{...book,tinhtrang:true,ngaytra,overdueDays:finalOverdueDays};}return book;})}:record);setBorrowedRecords(updatedRecords);setFilteredRecords(applyCurrentFilters(updatedRecords));if((selectedRecord===null||selectedRecord===void 0?void 0:selectedRecord.maphieumuon)===maphieumuon){setSelectedRecord({...selectedRecord,books:selectedRecord.books.map(book=>{if(book.masach===masach){const dueDate=book.ngayhentra||selectedRecord.ngayhentra;const returnDate=new Date(ngaytra);const due=new Date(dueDate);returnDate.setHours(0,0,0,0);due.setHours(0,0,0,0);const diffTime=returnDate.getTime()-due.getTime();const overdueDays=Math.floor(diffTime/(1000*60*60*24));const finalOverdueDays=overdueDays>0?overdueDays:0;return{...book,tinhtrang:true,ngaytra,overdueDays:finalOverdueDays};}return book;})});}toast.success('Trả sách thành công!');}}catch(err){var _err$response2,_err$response2$data;toast.error(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||'Lỗi khi trả sách!');}finally{setIsLoading(false);}};// Trả tất cả sách\nconst handleReturnAllBooks=async maphieumuon=>{setIsLoading(true);const ngaytra=normalizeDate(new Date());try{const response=await request.post('/api/ReturnAllBooks',{maphieumuon,ngaytra});if(response.status===200){const updatedRecords=borrowedRecords.map(record=>record.maphieumuon===maphieumuon?{...record,books:record.books.map(book=>{const dueDate=book.ngayhentra||record.ngayhentra;const returnDate=new Date(ngaytra);const due=new Date(dueDate);returnDate.setHours(0,0,0,0);due.setHours(0,0,0,0);const diffTime=returnDate.getTime()-due.getTime();const overdueDays=Math.floor(diffTime/(1000*60*60*24));const finalOverdueDays=overdueDays>0?overdueDays:0;return{...book,tinhtrang:true,ngaytra,overdueDays:finalOverdueDays};})}:record);setBorrowedRecords(updatedRecords);setFilteredRecords(applyCurrentFilters(updatedRecords));if((selectedRecord===null||selectedRecord===void 0?void 0:selectedRecord.maphieumuon)===maphieumuon){setSelectedRecord({...selectedRecord,books:selectedRecord.books.map(book=>{const dueDate=book.ngayhentra||selectedRecord.ngayhentra;const returnDate=new Date(ngaytra);const due=new Date(dueDate);returnDate.setHours(0,0,0,0);due.setHours(0,0,0,0);const diffTime=returnDate.getTime()-due.getTime();const overdueDays=Math.floor(diffTime/(1000*60*60*24));const finalOverdueDays=overdueDays>0?overdueDays:0;return{...book,tinhtrang:true,ngaytra,overdueDays:finalOverdueDays};})});}toast.success('Trả tất cả sách thành công!');}}catch(err){var _err$response3,_err$response3$data;toast.error(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'Lỗi khi trả sách!');}finally{setIsLoading(false);}};// Gia hạn tất cả sách\nconst handleExtendAllBorrowing=async maphieumuon=>{setIsLoading(true);try{const response=await request.post('/api/AdminExtendAllBooks',{maphieumuon});if(response.status===200){const updatedRecords=borrowedRecords.map(record=>record.maphieumuon===maphieumuon?{...record,books:record.books.map(book=>({...book,ngayhentra:response.data.newDueDate}))}:record);setBorrowedRecords(updatedRecords);setFilteredRecords(applyCurrentFilters(updatedRecords));if((selectedRecord===null||selectedRecord===void 0?void 0:selectedRecord.maphieumuon)===maphieumuon){setSelectedRecord({...selectedRecord,books:selectedRecord.books.map(book=>({...book,ngayhentra:response.data.newDueDate}))});}toast.success('Gia hạn tất cả sách thành công!');}}catch(err){var _err$response4,_err$response4$data;toast.error(((_err$response4=err.response)===null||_err$response4===void 0?void 0:(_err$response4$data=_err$response4.data)===null||_err$response4$data===void 0?void 0:_err$response4$data.message)||'Lỗi khi gia hạn!');}finally{setIsLoading(false);}};// Gia hạn một sách\nconst handleExtendBorrowing=async(maphieumuon,masach)=>{setIsLoading(true);try{const response=await request.post('/api/AdminExtendBook',{maphieumuon,masach});if(response.status===200){const updatedRecords=borrowedRecords.map(record=>record.maphieumuon===maphieumuon?{...record,books:record.books.map(book=>book.masach===masach?{...book,ngayhentra:response.data.newDueDate}:book)}:record);setBorrowedRecords(updatedRecords);setFilteredRecords(applyCurrentFilters(updatedRecords));if((selectedRecord===null||selectedRecord===void 0?void 0:selectedRecord.maphieumuon)===maphieumuon){setSelectedRecord({...selectedRecord,books:selectedRecord.books.map(book=>book.masach===masach?{...book,ngayhentra:response.data.newDueDate}:book)});}toast.success('Gia hạn thời gian mượn thành công!');}}catch(err){var _err$response5,_err$response5$data;toast.error(((_err$response5=err.response)===null||_err$response5===void 0?void 0:(_err$response5$data=_err$response5.data)===null||_err$response5$data===void 0?void 0:_err$response5$data.message)||'Lỗi khi gia hạn!');}finally{setIsLoading(false);}};// Hiển thị modal chi tiết\nconst handleShowDetails=record=>{setSelectedRecord(record);setShowModal(true);};const handleCloseModal=()=>{setShowModal(false);setSelectedRecord(null);};// Phân trang\nconst indexOfLastItem=currentPage*itemsPerPage;const indexOfFirstItem=indexOfLastItem-itemsPerPage;const currentItems=filteredRecords.slice(indexOfFirstItem,indexOfLastItem);const totalPages=Math.ceil(filteredRecords.length/itemsPerPage);const handlePageChange=pageNumber=>{setCurrentPage(pageNumber);};// Trạng thái phiếu mượn\nconst getRecordStatus=books=>{const allReturned=books.every(book=>book.tinhtrang);if(allReturned){return/*#__PURE__*/_jsxs(\"span\",{className:\"text-success\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheck,className:\"me-1\"}),\" \\u0110\\xE3 tr\\u1EA3\"]});}return/*#__PURE__*/_jsxs(\"span\",{className:\"text-danger\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTimes,className:\"me-1\"}),\" Ch\\u01B0a tr\\u1EA3\"]});};// Trạng thái quá hạn\nconst getOverdueStatus=(books,record)=>{const hasOverdue=books.some(book=>book.tinhtrang?book.overdueDays>0:calculateOverdueDays(book.ngayhentra||record.ngayhentra,book.tinhtrang,book.overdueDays)>0);return hasOverdue?'Có':'Không';};// Tùy chọn bộ lọc\nconst overdueOptions=[{value:'overdue',label:'Quá hạn'},{value:'notOverdue',label:'Không quá hạn'}];const confirmedOptions=[{value:'confirmed',label:'Đã xác nhận'},{value:'notConfirmed',label:'Chưa xác nhận'}];return/*#__PURE__*/_jsxs(\"div\",{className:cx('wrapper'),children:[/*#__PURE__*/_jsx(ToastContainer,{position:\"top-right\",autoClose:1000,hideProgressBar:false,newestOnTop:false,closeOnClick:true,rtl:false,pauseOnFocusLoss:true,draggable:true,pauseOnHover:true}),/*#__PURE__*/_jsx(\"div\",{className:\"container my-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row align-items-center justify-content-between g-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-12 col-md-4 text-center text-md-start\",children:/*#__PURE__*/_jsx(\"h4\",{className:\"mb-0 fw-bold\",children:\"Qu\\u1EA3n L\\xFD S\\xE1ch M\\u01B0\\u1EE3n\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3\",children:/*#__PURE__*/_jsx(\"form\",{className:\"d-flex\",children:/*#__PURE__*/_jsx(\"input\",{className:\"form-control me-2\",type:\"search\",placeholder:\"T\\xECm ki\\u1EBFm...\",\"aria-label\":\"Search\",value:searchValue,onChange:e=>setSearchValue(e.target.value)})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-12 col-md-3 text-center text-md-end\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowAddModal(true),className:\"btn btn-primary me-2\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg me-2\"}),\"Th\\xEAm\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowFilterForm(!showFilterForm),className:\"btn btn-secondary\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-filter me-2\"}),\"L\\u1ECDc\"]})]})]})}),showFilterForm&&/*#__PURE__*/_jsx(\"div\",{className:cx('filter-form'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"card p-4\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"L\\u1ECDc Phi\\u1EBFu M\\u01B0\\u1EE3n\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleFilterSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row g-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Ng\\xE0y M\\u01B0\\u1EE3n\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(DatePicker,{selected:filterBorrowStartDate,onChange:date=>setFilterBorrowStartDate(normalizeDate(date)),dateFormat:\"dd/MM/yyyy\",maxDate:new Date(),placeholderText:\"T\\u1EEB ng\\xE0y\",className:\"form-control\",isClearable:true}),/*#__PURE__*/_jsx(DatePicker,{selected:filterBorrowEndDate,onChange:date=>setFilterBorrowEndDate(normalizeDate(date)),dateFormat:\"dd/MM/yyyy\",maxDate:new Date(),placeholderText:\"\\u0110\\u1EBFn ng\\xE0y\",className:\"form-control\",isClearable:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Ng\\xE0y H\\u1EB9n Tr\\u1EA3\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(DatePicker,{selected:filterDueStartDate,onChange:date=>setFilterDueStartDate(normalizeDate(date)),dateFormat:\"dd/MM/yyyy\",maxDate:new Date(),placeholderText:\"T\\u1EEB ng\\xE0y\",className:\"form-control\",isClearable:true}),/*#__PURE__*/_jsx(DatePicker,{selected:filterDueEndDate,onChange:date=>setFilterDueEndDate(normalizeDate(date)),dateFormat:\"dd/MM/yyyy\",maxDate:new Date(),placeholderText:\"\\u0110\\u1EBFn ng\\xE0y\",className:\"form-control\",isClearable:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Qu\\xE1 H\\u1EA1n\"}),/*#__PURE__*/_jsx(Select,{options:overdueOptions,value:filterOverdue,onChange:setFilterOverdue,placeholder:\"L\\u1EF1a ch\\u1ECDn...\",isClearable:true,isSearchable:true,classNamePrefix:\"react-select\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"X\\xE1c Nh\\u1EADn\"}),/*#__PURE__*/_jsx(Select,{options:confirmedOptions,value:filterConfirmed,onChange:setFilterConfirmed,placeholder:\"L\\u1EF1a ch\\u1ECDn...\",isClearable:true,isSearchable:true,classNamePrefix:\"react-select\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 d-flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",children:\"\\xC1p d\\u1EE5ng\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-outline-secondary\",onClick:handleFilterReset,children:\"X\\xF3a b\\u1ED9 l\\u1ECDc\"})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-hover table-bordered align-middle\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-dark\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"M\\xE3 Phi\\u1EBFu\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"M\\xE3 Sinh Vi\\xEAn\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Ng\\xE0y M\\u01B0\\u1EE3n\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Ng\\xE0y H\\u1EB9n Tr\\u1EA3\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Qu\\xE1 H\\u1EA1n\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Tr\\u1EA1ng Th\\xE1i\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"X\\xE1c Nh\\u1EADn\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"H\\xE0nh \\u0110\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:currentItems.length>0?currentItems.map(record=>{var _record$books$find;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:record.maphieumuon}),/*#__PURE__*/_jsx(\"td\",{children:record.masinhvien}),/*#__PURE__*/_jsx(\"td\",{children:formatDate(record.ngaymuon)}),/*#__PURE__*/_jsx(\"td\",{children:formatDate(record.ngayhentra)}),/*#__PURE__*/_jsx(\"td\",{className:getOverdueStatus(record.books,record)==='Có'?'text-danger fw-bold':'',children:getOverdueStatus(record.books,record)}),/*#__PURE__*/_jsx(\"td\",{children:getRecordStatus(record.books)}),/*#__PURE__*/_jsx(\"td\",{children:record.books.some(book=>!book.confirm&&!book.tinhtrang)&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success btn-sm w-100\",onClick:()=>record.books.forEach(book=>!book.confirm&&!book.tinhtrang&&handleConfirmBorrow(record.maphieumuon,book.masach)),disabled:isLoading,children:\"X\\xE1c nh\\u1EADn\"})}),/*#__PURE__*/_jsx(\"td\",{children:record.books.some(book=>book.confirm&&!book.tinhtrang)?/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2 flex-wrap\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-warning btn-sm\",onClick:()=>handleReturnAllBooks(record.maphieumuon),disabled:isLoading,children:\"Tr\\u1EA3 T\\u1EA5t C\\u1EA3\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-info btn-sm\",onClick:()=>handleExtendAllBorrowing(record.maphieumuon),disabled:isLoading,children:\"Gia H\\u1EA1n T\\u1EA5t C\\u1EA3\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-primary btn-sm\",onClick:()=>handleShowDetails(record),disabled:isLoading,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faInfoCircle}),\" Chi Ti\\u1EBFt\"]})]}):record.books.some(book=>book.tinhtrang)?/*#__PURE__*/_jsxs(\"span\",{children:[formatDate(((_record$books$find=record.books.find(book=>book.tinhtrang))===null||_record$books$find===void 0?void 0:_record$books$find.ngaytra)||record.ngaytra),/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-primary btn-sm ms-2\",onClick:()=>handleShowDetails(record),disabled:isLoading,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faInfoCircle}),\" Chi Ti\\u1EBFt\"]})]}):/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-primary btn-sm\",onClick:()=>handleShowDetails(record),disabled:isLoading,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faInfoCircle}),\" Chi Ti\\u1EBFt\"]})})]},record.maphieumuon);}):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"8\",className:\"text-center\",children:\"Kh\\xF4ng c\\xF3 d\\u1EEF li\\u1EC7u phi\\u1EBFu m\\u01B0\\u1EE3n\"})})})]})}),filteredRecords.length>0&&/*#__PURE__*/_jsx(\"nav\",{\"aria-label\":\"Page navigation\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"pagination justify-content-center mt-3\",children:[/*#__PURE__*/_jsx(\"li\",{className:`page-item ${currentPage===1?'disabled':''}`,children:/*#__PURE__*/_jsx(\"button\",{className:\"page-link\",onClick:()=>handlePageChange(currentPage-1),disabled:currentPage===1||isLoading,children:\"Tr\\u01B0\\u1EDBc\"})}),Array.from({length:totalPages},(_,i)=>i+1).map(page=>/*#__PURE__*/_jsx(\"li\",{className:`page-item ${currentPage===page?'active':''}`,children:/*#__PURE__*/_jsx(\"button\",{className:\"page-link\",onClick:()=>handlePageChange(page),disabled:isLoading,children:page})},page)),/*#__PURE__*/_jsx(\"li\",{className:`page-item ${currentPage===totalPages?'disabled':''}`,children:/*#__PURE__*/_jsx(\"button\",{className:\"page-link\",onClick:()=>handlePageChange(currentPage+1),disabled:currentPage===totalPages||isLoading,children:\"Sau\"})})]})})]}),/*#__PURE__*/_jsxs(Modal,{show:showModal,onHide:handleCloseModal,size:\"lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsxs(Modal.Title,{children:[\"Chi Ti\\u1EBFt Phi\\u1EBFu M\\u01B0\\u1EE3n: \",selectedRecord===null||selectedRecord===void 0?void 0:selectedRecord.maphieumuon]})}),/*#__PURE__*/_jsx(Modal.Body,{children:selectedRecord&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"M\\xE3 Sinh Vi\\xEAn:\"}),\" \",selectedRecord.masinhvien]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Ng\\xE0y M\\u01B0\\u1EE3n:\"}),\" \",formatDate(selectedRecord.ngaymuon)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Ng\\xE0y H\\u1EB9n Tr\\u1EA3:\"}),\" \",formatDate(selectedRecord.ngayhentra)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Ti\\u1EC1n Ph\\u1EA1t:\"}),' ',/*#__PURE__*/_jsxs(\"span\",{className:calculateFine(selectedRecord.books,selectedRecord)>0?'text-danger fw-bold':'',children:[calculateFine(selectedRecord.books,selectedRecord).toLocaleString('vi-VN'),\" VND\"]})]}),/*#__PURE__*/_jsx(\"h5\",{children:\"Danh S\\xE1ch S\\xE1ch:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-bordered table-hover\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"M\\xE3 S\\xE1ch\"}),/*#__PURE__*/_jsx(\"th\",{children:\"T\\xEAn S\\xE1ch\"}),/*#__PURE__*/_jsx(\"th\",{children:\"S\\u1ED1 L\\u01B0\\u1EE3ng\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Ng\\xE0y H\\u1EB9n Tr\\u1EA3\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Qu\\xE1 H\\u1EA1n\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Tr\\u1EA1ng Th\\xE1i\"}),/*#__PURE__*/_jsx(\"th\",{children:\"H\\xE0nh \\u0110\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:selectedRecord.books.map(book=>{const dueDate=book.ngayhentra||selectedRecord.ngayhentra;const overdueDays=calculateOverdueDays(dueDate,book.tinhtrang,book.overdueDays);return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:book.masach}),/*#__PURE__*/_jsx(\"td\",{children:book.tensach}),/*#__PURE__*/_jsx(\"td\",{children:book.soluong||1}),/*#__PURE__*/_jsx(\"td\",{children:formatDate(dueDate)}),/*#__PURE__*/_jsx(\"td\",{className:overdueDays>0?'text-danger fw-bold':'',children:overdueDays>0?`${overdueDays} ngày`:'Không'}),/*#__PURE__*/_jsx(\"td\",{children:book.tinhtrang?/*#__PURE__*/_jsxs(\"span\",{className:\"text-success\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheck,className:\"me-1\"}),\" \\u0110\\xE3 tr\\u1EA3\"]}):/*#__PURE__*/_jsxs(\"span\",{className:\"text-danger\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTimes,className:\"me-1\"}),\" Ch\\u01B0a tr\\u1EA3\"]})}),/*#__PURE__*/_jsx(\"td\",{children:book.confirm&&!book.tinhtrang?/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-warning btn-sm\",onClick:()=>handleReturnBook(selectedRecord.maphieumuon,book.masach),disabled:isLoading,children:\"Tr\\u1EA3 S\\xE1ch\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-info btn-sm\",onClick:()=>handleExtendBorrowing(selectedRecord.maphieumuon,book.masach),disabled:isLoading,children:\"Gia H\\u1EA1n\"})]}):book.tinhtrang?/*#__PURE__*/_jsx(\"span\",{children:formatDate(book.ngaytra)}):/*#__PURE__*/_jsx(\"span\",{children:\"-\"})})]},book.masach);})})]})})]})}),/*#__PURE__*/_jsx(Modal.Footer,{children:/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleCloseModal,disabled:isLoading,children:\"\\u0110\\xF3ng\"})})]}),/*#__PURE__*/_jsx(ModalAddHandleBook,{visible:showAddModal,onCancel:()=>setShowAddModal(false),onSuccess:fetchBorrowedBooks})]});}export default HandleBook;","map":{"version":3,"names":["useEffect","useState","request","classNames","styles","FontAwesomeIcon","faCheck","faTimes","faInfoCircle","ToastContainer","toast","useDebounce","Modal","Button","ModalAddHandleBook","Select","DatePicker","jsx","_jsx","jsxs","_jsxs","cx","bind","HandleBook","borrowedRecords","setBorrowedRecords","filteredRecords","setFilteredRecords","currentPage","setCurrentPage","itemsPerPage","searchValue","setSearchValue","showModal","setShowModal","selectedRecord","setSelectedRecord","isLoading","setIsLoading","showAddModal","setShowAddModal","showFilterForm","setShowFilterForm","debounce","filterBorrowStartDate","setFilterBorrowStartDate","filterBorrowEndDate","setFilterBorrowEndDate","filterDueStartDate","setFilterDueStartDate","filterDueEndDate","setFilterDueEndDate","filterOverdue","setFilterOverdue","filterConfirmed","setFilterConfirmed","formatDate","dateString","date","Date","isNaN","getTime","day","String","getDate","padStart","month","getMonth","year","getFullYear","normalizeDate","calculateOverdueDays","dueDate","isReturned","arguments","length","undefined","savedOverdueDays","today","due","setHours","diffTime","diffDays","Math","floor","calculateFine","books","record","totalOverdueDays","reduce","total","book","ngayhentra","overdueDays","tinhtrang","applyCurrentFilters","records","filtered","filter","borrowDate","ngaymuon","startDate","endDate","value","some","every","confirm","trim","maphieumuon","toLowerCase","includes","masinhvien","fetchBorrowedBooks","response","get","data","Array","isArray","updatedData","map","ngaytra","returnDate","err","error","cancelUnconfirmedBorrows","post","success","fetchSearchResults","timphieu","searchData","initialize","totalPages","ceil","handleFilterSubmit","e","preventDefault","handleFilterReset","handleConfirmBorrow","masach","status","updatedRecords","_err$response","_err$response$data","message","handleReturnBook","finalOverdueDays","_err$response2","_err$response2$data","handleReturnAllBooks","_err$response3","_err$response3$data","handleExtendAllBorrowing","newDueDate","_err$response4","_err$response4$data","handleExtendBorrowing","_err$response5","_err$response5$data","handleShowDetails","handleCloseModal","indexOfLastItem","indexOfFirstItem","currentItems","slice","handlePageChange","pageNumber","getRecordStatus","allReturned","className","children","icon","getOverdueStatus","hasOverdue","overdueOptions","label","confirmedOptions","position","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover","type","placeholder","onChange","target","onClick","onSubmit","selected","dateFormat","maxDate","placeholderText","isClearable","options","isSearchable","classNamePrefix","scope","_record$books$find","forEach","disabled","find","colSpan","from","_","i","page","show","onHide","size","Header","closeButton","Title","Body","toLocaleString","tensach","soluong","Footer","variant","visible","onCancel","onSuccess"],"sources":["E:/Documents/Hoc_Tap/LATN/client/src/Page/Admin/Layouts/HandleBook/HandleBook.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport request from '../../../../config/Connect';\r\nimport classNames from 'classnames/bind';\r\nimport styles from './HandleBooks.module.scss';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faCheck, faTimes, faInfoCircle } from '@fortawesome/free-solid-svg-icons';\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport useDebounce from '../../../../customHook/useDebounce';\r\nimport { Modal, Button } from 'react-bootstrap';\r\nimport ModalAddHandleBook from '../../../../Modal/ExtenBooks/ModalAddHandleBook';\r\nimport Select from 'react-select';\r\nimport DatePicker from 'react-datepicker';\r\nimport 'react-datepicker/dist/react-datepicker.css';\r\n\r\nconst cx = classNames.bind(styles);\r\n\r\nfunction HandleBook() {\r\n    const [borrowedRecords, setBorrowedRecords] = useState([]);\r\n    const [filteredRecords, setFilteredRecords] = useState([]);\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [itemsPerPage] = useState(10);\r\n    const [searchValue, setSearchValue] = useState('');\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [selectedRecord, setSelectedRecord] = useState(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [showFilterForm, setShowFilterForm] = useState(false);\r\n    const debounce = useDebounce(searchValue, 500);\r\n\r\n    // State cho bộ lọc\r\n    const [filterBorrowStartDate, setFilterBorrowStartDate] = useState(null);\r\n    const [filterBorrowEndDate, setFilterBorrowEndDate] = useState(null);\r\n    const [filterDueStartDate, setFilterDueStartDate] = useState(null);\r\n    const [filterDueEndDate, setFilterDueEndDate] = useState(null);\r\n    const [filterOverdue, setFilterOverdue] = useState(null);\r\n    const [filterConfirmed, setFilterConfirmed] = useState(null);\r\n\r\n    // Hàm format ngày\r\n    const formatDate = (dateString) => {\r\n        if (!dateString) return 'N/A';\r\n        try {\r\n            const date = new Date(dateString);\r\n            if (isNaN(date.getTime())) return 'N/A';\r\n            const day = String(date.getDate()).padStart(2, '0');\r\n            const month = String(date.getMonth() + 1).padStart(2, '0');\r\n            const year = date.getFullYear();\r\n            return `${day}/${month}/${year}`;\r\n        } catch {\r\n            return 'N/A';\r\n        }\r\n    };\r\n\r\n    // Hàm chuẩn hóa ngày\r\n    const normalizeDate = (date) => {\r\n        if (!date) return null;\r\n        try {\r\n            const year = date.getFullYear();\r\n            const month = String(date.getMonth() + 1).padStart(2, '0');\r\n            const day = String(date.getDate()).padStart(2, '0');\r\n            return `${year}-${month}-${day}`;\r\n        } catch {\r\n            return null;\r\n        }\r\n    };\r\n\r\n    // Hàm tính số ngày quá hạn\r\n    const calculateOverdueDays = (dueDate, isReturned = false, savedOverdueDays = 0) => {\r\n        if (isReturned && savedOverdueDays !== undefined) {\r\n            return savedOverdueDays;\r\n        }\r\n        if (!dueDate || isReturned) return 0;\r\n        try {\r\n            const today = new Date();\r\n            const due = new Date(dueDate);\r\n            today.setHours(0, 0, 0, 0);\r\n            due.setHours(0, 0, 0, 0);\r\n            const diffTime = today.getTime() - due.getTime();\r\n            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n            return diffDays > 0 ? diffDays : 0;\r\n        } catch {\r\n            return 0;\r\n        }\r\n    };\r\n\r\n    // Hàm tính tiền phạt\r\n    const calculateFine = (books, record) => {\r\n        const totalOverdueDays = books.reduce((total, book) => {\r\n            const dueDate = book.ngayhentra || record.ngayhentra;\r\n            const overdueDays = calculateOverdueDays(dueDate, book.tinhtrang, book.overdueDays);\r\n            return total + overdueDays;\r\n        }, 0);\r\n        return totalOverdueDays * 2000;\r\n    };\r\n\r\n    // Hàm áp dụng bộ lọc hiện tại\r\n    const applyCurrentFilters = (records) => {\r\n        let filtered = [...records];\r\n\r\n        if (filterBorrowStartDate) {\r\n            filtered = filtered.filter((record) => {\r\n                const borrowDate = new Date(record.ngaymuon);\r\n                const startDate = new Date(filterBorrowStartDate);\r\n                return borrowDate >= startDate;\r\n            });\r\n        }\r\n        if (filterBorrowEndDate) {\r\n            filtered = filtered.filter((record) => {\r\n                const borrowDate = new Date(record.ngaymuon);\r\n                const endDate = new Date(filterBorrowEndDate);\r\n                return borrowDate <= endDate;\r\n            });\r\n        }\r\n\r\n        if (filterDueStartDate) {\r\n            filtered = filtered.filter((record) => {\r\n                const dueDate = new Date(record.ngayhentra);\r\n                const startDate = new Date(filterDueStartDate);\r\n                return dueDate >= startDate;\r\n            });\r\n        }\r\n        if (filterDueEndDate) {\r\n            filtered = filtered.filter((record) => {\r\n                const dueDate = new Date(record.ngayhentra);\r\n                const endDate = new Date(filterDueEndDate);\r\n                return dueDate <= endDate;\r\n            });\r\n        }\r\n\r\n        if (filterOverdue?.value === 'overdue') {\r\n            filtered = filtered.filter((record) =>\r\n                record.books.some((book) =>\r\n                    calculateOverdueDays(book.ngayhentra || record.ngayhentra, book.tinhtrang, book.overdueDays) > 0\r\n                )\r\n            );\r\n        } else if (filterOverdue?.value === 'notOverdue') {\r\n            filtered = filtered.filter((record) =>\r\n                record.books.every((book) =>\r\n                    calculateOverdueDays(book.ngayhentra || record.ngayhentra, book.tinhtrang, book.overdueDays) === 0\r\n                )\r\n            );\r\n        }\r\n\r\n        if (filterConfirmed?.value === 'confirmed') {\r\n            filtered = filtered.filter((record) =>\r\n                record.books.every((book) => book.confirm || book.tinhtrang)\r\n            );\r\n        } else if (filterConfirmed?.value === 'notConfirmed') {\r\n            filtered = filtered.filter((record) =>\r\n                record.books.some((book) => !book.confirm && !book.tinhtrang)\r\n            );\r\n        }\r\n\r\n        if (debounce.trim()) {\r\n            filtered = filtered.filter((record) =>\r\n                record.maphieumuon.toLowerCase().includes(debounce.toLowerCase()) ||\r\n                record.masinhvien.toLowerCase().includes(debounce.toLowerCase())\r\n            );\r\n        }\r\n\r\n        return filtered;\r\n    };\r\n\r\n    // Lấy danh sách phiếu mượn\r\n    const fetchBorrowedBooks = async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const response = await request.get('/api/GetBorrowedBooks');\r\n            const data = Array.isArray(response.data) ? response.data : [];\r\n            const updatedData = data.map((record) => ({\r\n                ...record,\r\n                books: record.books.map((book) => {\r\n                    if (book.tinhtrang && book.ngaytra) {\r\n                        const dueDate = new Date(book.ngayhentra || record.ngayhentra);\r\n                        const returnDate = new Date(book.ngaytra);\r\n                        dueDate.setHours(0, 0, 0, 0);\r\n                        returnDate.setHours(0, 0, 0, 0);\r\n                        const diffTime = returnDate.getTime() - dueDate.getTime();\r\n                        const overdueDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n                        return {\r\n                            ...book,\r\n                            overdueDays: overdueDays > 0 ? overdueDays : 0,\r\n                        };\r\n                    }\r\n                    return book;\r\n                }),\r\n            }));\r\n            setBorrowedRecords(updatedData);\r\n            setFilteredRecords(applyCurrentFilters(updatedData));\r\n        } catch (err) {\r\n            setBorrowedRecords([]);\r\n            setFilteredRecords([]);\r\n            toast.error('Lỗi khi tải danh sách phiếu mượn!');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Hủy các phiếu mượn chưa xác nhận\r\n    const cancelUnconfirmedBorrows = async () => {\r\n        try {\r\n            const response = await request.post('/api/cancelUnconfirmedBorrows');\r\n            if (response.data.success) {\r\n                await fetchBorrowedBooks();\r\n            }\r\n        } catch (err) {\r\n            // Xử lý lỗi im lặng\r\n        }\r\n    };\r\n\r\n    // Tìm kiếm phiếu mượn\r\n    const fetchSearchResults = async () => {\r\n        try {\r\n            if (!debounce.trim()) {\r\n                setFilteredRecords(applyCurrentFilters(borrowedRecords));\r\n                setCurrentPage(1);\r\n                return;\r\n            }\r\n\r\n            const response = await request.post('/api/SearchBorrowRecords', {\r\n                timphieu: debounce.trim(),\r\n            });\r\n\r\n            const searchData = Array.isArray(response.data.data) ? response.data.data : [];\r\n            setFilteredRecords(applyCurrentFilters(searchData));\r\n            setCurrentPage(1);\r\n        } catch (err) {\r\n            setFilteredRecords([]);\r\n            toast.error('Không tìm thấy phiếu mượn!');\r\n        }\r\n    };\r\n\r\n    // Khởi tạo\r\n    useEffect(() => {\r\n        const initialize = async () => {\r\n            await cancelUnconfirmedBorrows();\r\n            await fetchBorrowedBooks();\r\n        };\r\n        initialize();\r\n    }, []);\r\n\r\n    // Tìm kiếm khi debounce thay đổi\r\n    useEffect(() => {\r\n        fetchSearchResults();\r\n    }, [debounce]);\r\n\r\n    // Điều chỉnh currentPage khi filteredRecords thay đổi\r\n    useEffect(() => {\r\n        const totalPages = Math.ceil(filteredRecords.length / itemsPerPage);\r\n        if (currentPage > totalPages && totalPages > 0) {\r\n            setCurrentPage(totalPages);\r\n        }\r\n    }, [filteredRecords, itemsPerPage, currentPage]);\r\n\r\n    // Xử lý lọc phiếu mượn\r\n    const handleFilterSubmit = (e) => {\r\n        e.preventDefault();\r\n\r\n        if (\r\n            filterBorrowStartDate &&\r\n            filterBorrowEndDate &&\r\n            new Date(filterBorrowStartDate) > new Date(filterBorrowEndDate)\r\n        ) {\r\n            toast.error('Ngày mượn bắt đầu không được lớn hơn ngày kết thúc!');\r\n            return;\r\n        }\r\n        if (\r\n            filterDueStartDate &&\r\n            filterDueEndDate &&\r\n            new Date(filterDueStartDate) > new Date(filterDueEndDate)\r\n        ) {\r\n            toast.error('Ngày hẹn trả bắt đầu không được lớn hơn ngày kết thúc!');\r\n            return;\r\n        }\r\n\r\n        setFilteredRecords(applyCurrentFilters(borrowedRecords));\r\n        setShowFilterForm(false);\r\n    };\r\n\r\n    // Xóa bộ lọc\r\n    const handleFilterReset = () => {\r\n        setFilterBorrowStartDate(null);\r\n        setFilterBorrowEndDate(null);\r\n        setFilterDueStartDate(null);\r\n        setFilterDueEndDate(null);\r\n        setFilterOverdue(null);\r\n        setFilterConfirmed(null);\r\n        setFilteredRecords(borrowedRecords);\r\n        setCurrentPage(1);\r\n        setShowFilterForm(false);\r\n    };\r\n\r\n    // Xác nhận mượn sách\r\n    const handleConfirmBorrow = async (maphieumuon, masach) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const response = await request.post('/api/confirmBorrowRequest', { maphieumuon, masach });\r\n            if (response.status === 200) {\r\n                const updatedRecords = borrowedRecords.map((record) =>\r\n                    record.maphieumuon === maphieumuon\r\n                        ? {\r\n                            ...record,\r\n                            books: record.books.map((book) =>\r\n                                book.masach === masach ? { ...book, confirm: true } : book\r\n                            ),\r\n                        }\r\n                        : record\r\n                );\r\n                setBorrowedRecords(updatedRecords);\r\n                setFilteredRecords(applyCurrentFilters(updatedRecords));\r\n                toast.success('Xác nhận yêu cầu mượn sách thành công!');\r\n            }\r\n        } catch (err) {\r\n            toast.error(err.response?.data?.message || 'Lỗi khi xác nhận yêu cầu mượn!');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Trả một sách\r\n    const handleReturnBook = async (maphieumuon, masach) => {\r\n        setIsLoading(true);\r\n        const ngaytra = normalizeDate(new Date());\r\n        try {\r\n            const response = await request.post('/api/ReturnBook', {\r\n                maphieumuon,\r\n                masach,\r\n                ngaytra,\r\n            });\r\n            if (response.status === 200) {\r\n                const updatedRecords = borrowedRecords.map((record) =>\r\n                    record.maphieumuon === maphieumuon\r\n                        ? {\r\n                            ...record,\r\n                            books: record.books.map((book) => {\r\n                                if (book.masach === masach) {\r\n                                    const dueDate = book.ngayhentra || record.ngayhentra;\r\n                                    const returnDate = new Date(ngaytra);\r\n                                    const due = new Date(dueDate);\r\n                                    returnDate.setHours(0, 0, 0, 0);\r\n                                    due.setHours(0, 0, 0, 0);\r\n                                    const diffTime = returnDate.getTime() - due.getTime();\r\n                                    const overdueDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n                                    const finalOverdueDays = overdueDays > 0 ? overdueDays : 0;\r\n\r\n                                    return {\r\n                                        ...book,\r\n                                        tinhtrang: true,\r\n                                        ngaytra,\r\n                                        overdueDays: finalOverdueDays,\r\n                                    };\r\n                                }\r\n                                return book;\r\n                            }),\r\n                        }\r\n                        : record\r\n                );\r\n                setBorrowedRecords(updatedRecords);\r\n                setFilteredRecords(applyCurrentFilters(updatedRecords));\r\n                if (selectedRecord?.maphieumuon === maphieumuon) {\r\n                    setSelectedRecord({\r\n                        ...selectedRecord,\r\n                        books: selectedRecord.books.map((book) => {\r\n                            if (book.masach === masach) {\r\n                                const dueDate = book.ngayhentra || selectedRecord.ngayhentra;\r\n                                const returnDate = new Date(ngaytra);\r\n                                const due = new Date(dueDate);\r\n                                returnDate.setHours(0, 0, 0, 0);\r\n                                due.setHours(0, 0, 0, 0);\r\n                                const diffTime = returnDate.getTime() - due.getTime();\r\n                                const overdueDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n                                const finalOverdueDays = overdueDays > 0 ? overdueDays : 0;\r\n\r\n                                return {\r\n                                    ...book,\r\n                                    tinhtrang: true,\r\n                                    ngaytra,\r\n                                    overdueDays: finalOverdueDays,\r\n                                };\r\n                            }\r\n                            return book;\r\n                        }),\r\n                    });\r\n                }\r\n                toast.success('Trả sách thành công!');\r\n            }\r\n        } catch (err) {\r\n            toast.error(err.response?.data?.message || 'Lỗi khi trả sách!');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Trả tất cả sách\r\n    const handleReturnAllBooks = async (maphieumuon) => {\r\n        setIsLoading(true);\r\n        const ngaytra = normalizeDate(new Date());\r\n        try {\r\n            const response = await request.post('/api/ReturnAllBooks', {\r\n                maphieumuon,\r\n                ngaytra,\r\n            });\r\n            if (response.status === 200) {\r\n                const updatedRecords = borrowedRecords.map((record) =>\r\n                    record.maphieumuon === maphieumuon\r\n                        ? {\r\n                            ...record,\r\n                            books: record.books.map((book) => {\r\n                                const dueDate = book.ngayhentra || record.ngayhentra;\r\n                                const returnDate = new Date(ngaytra);\r\n                                const due = new Date(dueDate);\r\n                                returnDate.setHours(0, 0, 0, 0);\r\n                                due.setHours(0, 0, 0, 0);\r\n                                const diffTime = returnDate.getTime() - due.getTime();\r\n                                const overdueDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n                                const finalOverdueDays = overdueDays > 0 ? overdueDays : 0;\r\n\r\n                                return {\r\n                                    ...book,\r\n                                    tinhtrang: true,\r\n                                    ngaytra,\r\n                                    overdueDays: finalOverdueDays,\r\n                                };\r\n                            }),\r\n                        }\r\n                        : record\r\n                );\r\n                setBorrowedRecords(updatedRecords);\r\n                setFilteredRecords(applyCurrentFilters(updatedRecords));\r\n                if (selectedRecord?.maphieumuon === maphieumuon) {\r\n                    setSelectedRecord({\r\n                        ...selectedRecord,\r\n                        books: selectedRecord.books.map((book) => {\r\n                            const dueDate = book.ngayhentra || selectedRecord.ngayhentra;\r\n                            const returnDate = new Date(ngaytra);\r\n                            const due = new Date(dueDate);\r\n                            returnDate.setHours(0, 0, 0, 0);\r\n                            due.setHours(0, 0, 0, 0);\r\n                            const diffTime = returnDate.getTime() - due.getTime();\r\n                            const overdueDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n                            const finalOverdueDays = overdueDays > 0 ? overdueDays : 0;\r\n\r\n                            return {\r\n                                ...book,\r\n                                tinhtrang: true,\r\n                                ngaytra,\r\n                                overdueDays: finalOverdueDays,\r\n                            };\r\n                        }),\r\n                    });\r\n                }\r\n                toast.success('Trả tất cả sách thành công!');\r\n            }\r\n        } catch (err) {\r\n            toast.error(err.response?.data?.message || 'Lỗi khi trả sách!');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Gia hạn tất cả sách\r\n    const handleExtendAllBorrowing = async (maphieumuon) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const response = await request.post('/api/AdminExtendAllBooks', { maphieumuon });\r\n            if (response.status === 200) {\r\n                const updatedRecords = borrowedRecords.map((record) =>\r\n                    record.maphieumuon === maphieumuon\r\n                        ? {\r\n                            ...record,\r\n                            books: record.books.map((book) => ({\r\n                                ...book,\r\n                                ngayhentra: response.data.newDueDate,\r\n                            })),\r\n                        }\r\n                        : record\r\n                );\r\n                setBorrowedRecords(updatedRecords);\r\n                setFilteredRecords(applyCurrentFilters(updatedRecords));\r\n                if (selectedRecord?.maphieumuon === maphieumuon) {\r\n                    setSelectedRecord({\r\n                        ...selectedRecord,\r\n                        books: selectedRecord.books.map((book) => ({\r\n                            ...book,\r\n                            ngayhentra: response.data.newDueDate,\r\n                        })),\r\n                    });\r\n                }\r\n                toast.success('Gia hạn tất cả sách thành công!');\r\n            }\r\n        } catch (err) {\r\n            toast.error(err.response?.data?.message || 'Lỗi khi gia hạn!');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Gia hạn một sách\r\n    const handleExtendBorrowing = async (maphieumuon, masach) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const response = await request.post('/api/AdminExtendBook', { maphieumuon, masach });\r\n            if (response.status === 200) {\r\n                const updatedRecords = borrowedRecords.map((record) =>\r\n                    record.maphieumuon === maphieumuon\r\n                        ? {\r\n                            ...record,\r\n                            books: record.books.map((book) =>\r\n                                book.masach === masach\r\n                                    ? { ...book, ngayhentra: response.data.newDueDate }\r\n                                    : book\r\n                            ),\r\n                        }\r\n                        : record\r\n                );\r\n                setBorrowedRecords(updatedRecords);\r\n                setFilteredRecords(applyCurrentFilters(updatedRecords));\r\n                if (selectedRecord?.maphieumuon === maphieumuon) {\r\n                    setSelectedRecord({\r\n                        ...selectedRecord,\r\n                        books: selectedRecord.books.map((book) =>\r\n                            book.masach === masach\r\n                                ? { ...book, ngayhentra: response.data.newDueDate }\r\n                                : book\r\n                        ),\r\n                    });\r\n                }\r\n                toast.success('Gia hạn thời gian mượn thành công!');\r\n            }\r\n        } catch (err) {\r\n            toast.error(err.response?.data?.message || 'Lỗi khi gia hạn!');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Hiển thị modal chi tiết\r\n    const handleShowDetails = (record) => {\r\n        setSelectedRecord(record);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleCloseModal = () => {\r\n        setShowModal(false);\r\n        setSelectedRecord(null);\r\n    };\r\n\r\n    // Phân trang\r\n    const indexOfLastItem = currentPage * itemsPerPage;\r\n    const indexOfFirstItem = indexOfLastItem - itemsPerPage;\r\n    const currentItems = filteredRecords.slice(indexOfFirstItem, indexOfLastItem);\r\n    const totalPages = Math.ceil(filteredRecords.length / itemsPerPage);\r\n\r\n    const handlePageChange = (pageNumber) => {\r\n        setCurrentPage(pageNumber);\r\n    };\r\n\r\n    // Trạng thái phiếu mượn\r\n    const getRecordStatus = (books) => {\r\n        const allReturned = books.every((book) => book.tinhtrang);\r\n        if (allReturned) {\r\n            return (\r\n                <span className=\"text-success\">\r\n                    <FontAwesomeIcon icon={faCheck} className=\"me-1\" /> Đã trả\r\n                </span>\r\n            );\r\n        }\r\n        return (\r\n            <span className=\"text-danger\">\r\n                <FontAwesomeIcon icon={faTimes} className=\"me-1\" /> Chưa trả\r\n            </span>\r\n        );\r\n    };\r\n\r\n    // Trạng thái quá hạn\r\n    const getOverdueStatus = (books, record) => {\r\n        const hasOverdue = books.some((book) =>\r\n            book.tinhtrang\r\n                ? book.overdueDays > 0\r\n                : calculateOverdueDays(book.ngayhentra || record.ngayhentra, book.tinhtrang, book.overdueDays) > 0\r\n        );\r\n        return hasOverdue ? 'Có' : 'Không';\r\n    };\r\n\r\n    // Tùy chọn bộ lọc\r\n    const overdueOptions = [\r\n        { value: 'overdue', label: 'Quá hạn' },\r\n        { value: 'notOverdue', label: 'Không quá hạn' },\r\n    ];\r\n\r\n    const confirmedOptions = [\r\n        { value: 'confirmed', label: 'Đã xác nhận' },\r\n        { value: 'notConfirmed', label: 'Chưa xác nhận' },\r\n    ];\r\n\r\n    return (\r\n        <div className={cx('wrapper')}>\r\n            <ToastContainer\r\n                position=\"top-right\"\r\n                autoClose={1000}\r\n                hideProgressBar={false}\r\n                newestOnTop={false}\r\n                closeOnClick\r\n                rtl={false}\r\n                pauseOnFocusLoss\r\n                draggable\r\n                pauseOnHover\r\n            />\r\n            <div className=\"container my-4\">\r\n                <div className=\"row align-items-center justify-content-between g-3\">\r\n                    <div className=\"col-12 col-md-4 text-center text-md-start\">\r\n                        <h4 className=\"mb-0 fw-bold\">Quản Lý Sách Mượn</h4>\r\n                    </div>\r\n                    <div className=\"col-md-3\">\r\n                        <form className=\"d-flex\">\r\n                            <input\r\n                                className=\"form-control me-2\"\r\n                                type=\"search\"\r\n                                placeholder=\"Tìm kiếm...\"\r\n                                aria-label=\"Search\"\r\n                                value={searchValue}\r\n                                onChange={(e) => setSearchValue(e.target.value)}\r\n                            />\r\n                        </form>\r\n                    </div>\r\n                    <div className=\"col-12 col-md-3 text-center text-md-end\">\r\n                        <button\r\n                            onClick={() => setShowAddModal(true)}\r\n                            className=\"btn btn-primary me-2\"\r\n                        >\r\n                            <i className=\"bi bi-plus-lg me-2\"></i>Thêm\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setShowFilterForm(!showFilterForm)}\r\n                            className=\"btn btn-secondary\"\r\n                        >\r\n                            <i className=\"bi bi-filter me-2\"></i>Lọc\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {showFilterForm && (\r\n                <div className={cx('filter-form')}>\r\n                    <div className=\"card p-4\">\r\n                        <h5>Lọc Phiếu Mượn</h5>\r\n                        <form onSubmit={handleFilterSubmit}>\r\n                            <div className=\"row g-3\">\r\n                                <div className=\"col-md-4\">\r\n                                    <label className=\"form-label\">Ngày Mượn</label>\r\n                                    <div className=\"d-flex gap-2\">\r\n                                        <DatePicker\r\n                                            selected={filterBorrowStartDate}\r\n                                            onChange={(date) => setFilterBorrowStartDate(normalizeDate(date))}\r\n                                            dateFormat=\"dd/MM/yyyy\"\r\n                                            maxDate={new Date()}\r\n                                            placeholderText=\"Từ ngày\"\r\n                                            className=\"form-control\"\r\n                                            isClearable\r\n                                        />\r\n                                        <DatePicker\r\n                                            selected={filterBorrowEndDate}\r\n                                            onChange={(date) => setFilterBorrowEndDate(normalizeDate(date))}\r\n                                            dateFormat=\"dd/MM/yyyy\"\r\n                                            maxDate={new Date()}\r\n                                            placeholderText=\"Đến ngày\"\r\n                                            className=\"form-control\"\r\n                                            isClearable\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"col-md-4\">\r\n                                    <label className=\"form-label\">Ngày Hẹn Trả</label>\r\n                                    <div className=\"d-flex gap-2\">\r\n                                        <DatePicker\r\n                                            selected={filterDueStartDate}\r\n                                            onChange={(date) => setFilterDueStartDate(normalizeDate(date))}\r\n                                            dateFormat=\"dd/MM/yyyy\"\r\n                                            maxDate={new Date()}\r\n                                            placeholderText=\"Từ ngày\"\r\n                                            className=\"form-control\"\r\n                                            isClearable\r\n                                        />\r\n                                        <DatePicker\r\n                                            selected={filterDueEndDate}\r\n                                            onChange={(date) => setFilterDueEndDate(normalizeDate(date))}\r\n                                            dateFormat=\"dd/MM/yyyy\"\r\n                                            maxDate={new Date()}\r\n                                            placeholderText=\"Đến ngày\"\r\n                                            className=\"form-control\"\r\n                                            isClearable\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"col-md-2\">\r\n                                    <label className=\"form-label\">Quá Hạn</label>\r\n                                    <Select\r\n                                        options={overdueOptions}\r\n                                        value={filterOverdue}\r\n                                        onChange={setFilterOverdue}\r\n                                        placeholder=\"Lựa chọn...\"\r\n                                        isClearable\r\n                                        isSearchable\r\n                                        classNamePrefix=\"react-select\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"col-md-2\">\r\n                                    <label className=\"form-label\">Xác Nhận</label>\r\n                                    <Select\r\n                                        options={confirmedOptions}\r\n                                        value={filterConfirmed}\r\n                                        onChange={setFilterConfirmed}\r\n                                        placeholder=\"Lựa chọn...\"\r\n                                        isClearable\r\n                                        isSearchable\r\n                                        classNamePrefix=\"react-select\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"mt-4 d-flex gap-2\">\r\n                                <button type=\"submit\" className=\"btn btn-primary\">\r\n                                    Áp dụng\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    className=\"btn btn-outline-secondary\"\r\n                                    onClick={handleFilterReset}\r\n                                >\r\n                                    Xóa bộ lọc\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"container\">\r\n                <div className=\"table-responsive\">\r\n                    <table className=\"table table-striped table-hover table-bordered align-middle\">\r\n                        <thead className=\"table-dark\">\r\n                        <tr>\r\n                            <th scope=\"col\">Mã Phiếu</th>\r\n                            <th scope=\"col\">Mã Sinh Viên</th>\r\n                            <th scope=\"col\">Ngày Mượn</th>\r\n                            <th scope=\"col\">Ngày Hẹn Trả</th>\r\n                            <th scope=\"col\">Quá Hạn</th>\r\n                            <th scope=\"col\">Trạng Thái</th>\r\n                            <th scope=\"col\">Xác Nhận</th>\r\n                            <th scope=\"col\">Hành Động</th>\r\n                        </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                        {currentItems.length > 0 ? (\r\n                            currentItems.map((record) => (\r\n                                <tr key={record.maphieumuon}>\r\n                                    <td>{record.maphieumuon}</td>\r\n                                    <td>{record.masinhvien}</td>\r\n                                    <td>{formatDate(record.ngaymuon)}</td>\r\n                                    <td>{formatDate(record.ngayhentra)}</td>\r\n                                    <td\r\n                                        className={\r\n                                            getOverdueStatus(record.books, record) === 'Có'\r\n                                                ? 'text-danger fw-bold'\r\n                                                : ''\r\n                                        }\r\n                                    >\r\n                                        {getOverdueStatus(record.books, record)}\r\n                                    </td>\r\n                                    <td>{getRecordStatus(record.books)}</td>\r\n                                    <td>\r\n                                        {record.books.some((book) => !book.confirm && !book.tinhtrang) && (\r\n                                            <button\r\n                                                className=\"btn btn-success btn-sm w-100\"\r\n                                                onClick={() =>\r\n                                                    record.books.forEach(\r\n                                                        (book) =>\r\n                                                            !book.confirm &&\r\n                                                            !book.tinhtrang &&\r\n                                                            handleConfirmBorrow(record.maphieumuon, book.masach)\r\n                                                    )\r\n                                                }\r\n                                                disabled={isLoading}\r\n                                            >\r\n                                                Xác nhận\r\n                                            </button>\r\n                                        )}\r\n                                    </td>\r\n                                    <td>\r\n                                        {record.books.some((book) => book.confirm && !book.tinhtrang) ? (\r\n                                            <div className=\"d-flex gap-2 flex-wrap\">\r\n                                                <button\r\n                                                    className=\"btn btn-warning btn-sm\"\r\n                                                    onClick={() => handleReturnAllBooks(record.maphieumuon)}\r\n                                                    disabled={isLoading}\r\n                                                >\r\n                                                    Trả Tất Cả\r\n                                                </button>\r\n                                                <button\r\n                                                    className=\"btn btn-info btn-sm\"\r\n                                                    onClick={() => handleExtendAllBorrowing(record.maphieumuon)}\r\n                                                    disabled={isLoading}\r\n                                                >\r\n                                                    Gia Hạn Tất Cả\r\n                                                </button>\r\n                                                <button\r\n                                                    className=\"btn btn-primary btn-sm\"\r\n                                                    onClick={() => handleShowDetails(record)}\r\n                                                    disabled={isLoading}\r\n                                                >\r\n                                                    <FontAwesomeIcon icon={faInfoCircle} /> Chi Tiết\r\n                                                </button>\r\n                                            </div>\r\n                                        ) : record.books.some((book) => book.tinhtrang) ? (\r\n                                            <span>\r\n                                                {formatDate(\r\n                                                    record.books.find((book) => book.tinhtrang)?.ngaytra ||\r\n                                                    record.ngaytra\r\n                                                )}\r\n                                                <button\r\n                                                    className=\"btn btn-primary btn-sm ms-2\"\r\n                                                    onClick={() => handleShowDetails(record)}\r\n                                                    disabled={isLoading}\r\n                                                >\r\n                                                    <FontAwesomeIcon icon={faInfoCircle} /> Chi Tiết\r\n                                                </button>\r\n                                            </span>\r\n                                        ) : (\r\n                                            <button\r\n                                                className=\"btn btn-primary btn-sm\"\r\n                                                onClick={() => handleShowDetails(record)}\r\n                                                disabled={isLoading}\r\n                                            >\r\n                                                <FontAwesomeIcon icon={faInfoCircle} /> Chi Tiết\r\n                                            </button>\r\n                                        )}\r\n                                    </td>\r\n                                </tr>\r\n                            ))\r\n                        ) : (\r\n                            <tr>\r\n                                <td colSpan=\"8\" className=\"text-center\">\r\n                                    Không có dữ liệu phiếu mượn\r\n                                </td>\r\n                            </tr>\r\n                        )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n                {filteredRecords.length > 0 && (\r\n                    <nav aria-label=\"Page navigation\">\r\n                        <ul className=\"pagination justify-content-center mt-3\">\r\n                            <li className={`page-item ${currentPage === 1 ? 'disabled' : ''}`}>\r\n                                <button\r\n                                    className=\"page-link\"\r\n                                    onClick={() => handlePageChange(currentPage - 1)}\r\n                                    disabled={currentPage === 1 || isLoading}\r\n                                >\r\n                                    Trước\r\n                                </button>\r\n                            </li>\r\n                            {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (\r\n                                <li\r\n                                    key={page}\r\n                                    className={`page-item ${currentPage === page ? 'active' : ''}`}\r\n                                >\r\n                                    <button\r\n                                        className=\"page-link\"\r\n                                        onClick={() => handlePageChange(page)}\r\n                                        disabled={isLoading}\r\n                                    >\r\n                                        {page}\r\n                                    </button>\r\n                                </li>\r\n                            ))}\r\n                            <li className={`page-item ${currentPage === totalPages ? 'disabled' : ''}`}>\r\n                                <button\r\n                                    className=\"page-link\"\r\n                                    onClick={() => handlePageChange(currentPage + 1)}\r\n                                    disabled={currentPage === totalPages || isLoading}\r\n                                >\r\n                                    Sau\r\n                                </button>\r\n                            </li>\r\n                        </ul>\r\n                    </nav>\r\n                )}\r\n            </div>\r\n\r\n            <Modal show={showModal} onHide={handleCloseModal} size=\"lg\">\r\n                <Modal.Header closeButton>\r\n                    <Modal.Title>Chi Tiết Phiếu Mượn: {selectedRecord?.maphieumuon}</Modal.Title>\r\n                </Modal.Header>\r\n                <Modal.Body>\r\n                    {selectedRecord && (\r\n                        <div>\r\n                            <p>\r\n                                <strong>Mã Sinh Viên:</strong> {selectedRecord.masinhvien}\r\n                            </p>\r\n                            <p>\r\n                                <strong>Ngày Mượn:</strong> {formatDate(selectedRecord.ngaymuon)}\r\n                            </p>\r\n                            <p>\r\n                                <strong>Ngày Hẹn Trả:</strong> {formatDate(selectedRecord.ngayhentra)}\r\n                            </p>\r\n                            <p>\r\n                                <strong>Tiền Phạt:</strong>{' '}\r\n                                <span\r\n                                    className={\r\n                                        calculateFine(selectedRecord.books, selectedRecord) > 0\r\n                                            ? 'text-danger fw-bold'\r\n                                            : ''\r\n                                    }\r\n                                >\r\n                                    {calculateFine(selectedRecord.books, selectedRecord).toLocaleString('vi-VN')} VND\r\n                                </span>\r\n                            </p>\r\n                            <h5>Danh Sách Sách:</h5>\r\n                            <div className=\"table-responsive\">\r\n                                <table className=\"table table-bordered table-hover\">\r\n                                    <thead>\r\n                                    <tr>\r\n                                        <th>Mã Sách</th>\r\n                                        <th>Tên Sách</th>\r\n                                        <th>Số Lượng</th>\r\n                                        <th>Ngày Hẹn Trả</th>\r\n                                        <th>Quá Hạn</th>\r\n                                        <th>Trạng Thái</th>\r\n                                        <th>Hành Động</th>\r\n                                    </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                    {selectedRecord.books.map((book) => {\r\n                                        const dueDate = book.ngayhentra || selectedRecord.ngayhentra;\r\n                                        const overdueDays = calculateOverdueDays(dueDate, book.tinhtrang, book.overdueDays);\r\n                                        return (\r\n                                            <tr key={book.masach}>\r\n                                                <td>{book.masach}</td>\r\n                                                <td>{book.tensach}</td>\r\n                                                <td>{book.soluong || 1}</td>\r\n                                                <td>{formatDate(dueDate)}</td>\r\n                                                <td\r\n                                                    className={overdueDays > 0 ? 'text-danger fw-bold' : ''}\r\n                                                >\r\n                                                    {overdueDays > 0 ? `${overdueDays} ngày` : 'Không'}\r\n                                                </td>\r\n                                                <td>\r\n                                                    {book.tinhtrang ? (\r\n                                                        <span className=\"text-success\">\r\n                                                            <FontAwesomeIcon icon={faCheck} className=\"me-1\" /> Đã trả\r\n                                                        </span>\r\n                                                    ) : (\r\n                                                        <span className=\"text-danger\">\r\n                                                            <FontAwesomeIcon icon={faTimes} className=\"me-1\" /> Chưa trả\r\n                                                        </span>\r\n                                                    )}\r\n                                                </td>\r\n                                                <td>\r\n                                                    {book.confirm && !book.tinhtrang ? (\r\n                                                        <div className=\"d-flex gap-2\">\r\n                                                            <button\r\n                                                                className=\"btn btn-warning btn-sm\"\r\n                                                                onClick={() =>\r\n                                                                    handleReturnBook(\r\n                                                                        selectedRecord.maphieumuon,\r\n                                                                        book.masach\r\n                                                                    )\r\n                                                                }\r\n                                                                disabled={isLoading}\r\n                                                            >\r\n                                                                Trả Sách\r\n                                                            </button>\r\n                                                            <button\r\n                                                                className=\"btn btn-info btn-sm\"\r\n                                                                onClick={() =>\r\n                                                                    handleExtendBorrowing(\r\n                                                                        selectedRecord.maphieumuon,\r\n                                                                        book.masach\r\n                                                                    )\r\n                                                                }\r\n                                                                disabled={isLoading}\r\n                                                            >\r\n                                                                Gia Hạn\r\n                                                            </button>\r\n                                                        </div>\r\n                                                    ) : book.tinhtrang ? (\r\n                                                        <span>{formatDate(book.ngaytra)}</span>\r\n                                                    ) : (\r\n                                                        <span>-</span>\r\n                                                    )}\r\n                                                </td>\r\n                                            </tr>\r\n                                        );\r\n                                    })}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </Modal.Body>\r\n                <Modal.Footer>\r\n                    <Button variant=\"secondary\" onClick={handleCloseModal} disabled={isLoading}>\r\n                        Đóng\r\n                    </Button>\r\n                </Modal.Footer>\r\n            </Modal>\r\n\r\n            <ModalAddHandleBook\r\n                visible={showAddModal}\r\n                onCancel={() => setShowAddModal(false)}\r\n                onSuccess={fetchBorrowedBooks}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default HandleBook;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}