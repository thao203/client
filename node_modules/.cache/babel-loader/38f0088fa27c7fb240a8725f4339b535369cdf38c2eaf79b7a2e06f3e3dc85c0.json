{"ast":null,"code":"import{useState,useEffect}from'react';import Button from'react-bootstrap/Button';import Modal from'react-bootstrap/Modal';import request from'../../../../../config/Connect';import{ToastContainer,toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function ModalRequestBook(_ref){let{show,setShow,masach,tensach,vitri}=_ref;const handleClose=()=>setShow(false);const[quantity,setQuantity]=useState(1);const[ngaymuon,setNgaymuon]=useState('');const[mavitri,setMavitri]=useState('');const[locations,setLocations]=useState([]);// Set default borrow date to today\nuseEffect(()=>{const today=new Date().toISOString().split('T')[0];setNgaymuon(today);},[]);// Update locations and default mavitri when modal opens\nuseEffect(()=>{if(show&&vitri&&Array.isArray(vitri)){var _vitri$;setLocations(vitri);setMavitri(((_vitri$=vitri[0])===null||_vitri$===void 0?void 0:_vitri$.mavitri)||'');}else if(show){toast.error('Không có thông tin vị trí sách!');setLocations([]);setMavitri('');}},[show,vitri]);const toastOptions={position:'top-right',autoClose:1000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined,onClose:handleClose};const handleRequestBook=async()=>{var _document$cookie$spli;const token=(_document$cookie$spli=document.cookie.split('; ').find(row=>row.startsWith('token=')))===null||_document$cookie$spli===void 0?void 0:_document$cookie$spli.split('=')[1];if(!token){toast.error('Không có token, vui lòng đăng nhập lại!',toastOptions);return;}try{const books=[{masach,mavitri,soluong:parseInt(quantity)}];const res=await request.post('/api/requestborrowbook',{books,ngaymuon},{headers:{Authorization:`Bearer ${token}`}});if(res.data.message==='Yêu cầu mượn sách thành công !!!'){toast.success('Yêu cầu mượn sách thành công!',toastOptions);}else{toast.error(res.data.message,toastOptions);}}catch(error){var _error$response,_error$response$data;const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Có lỗi xảy ra khi mượn sách!';toast.error(errorMessage,toastOptions);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ToastContainer,{}),/*#__PURE__*/_jsxs(Modal,{show:show,onHide:handleClose,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Y\\xEAu C\\u1EA7u M\\u01B0\\u1EE3n S\\xE1ch\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-floating mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{value:masach||'',className:\"form-control\",disabled:true}),/*#__PURE__*/_jsx(\"label\",{children:\"M\\xE3 S\\xE1ch\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-floating mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{value:tensach||'',className:\"form-control\",disabled:true}),/*#__PURE__*/_jsx(\"label\",{children:\"T\\xEAn S\\xE1ch\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-floating mb-3\",children:[/*#__PURE__*/_jsx(\"select\",{className:\"form-control\",value:mavitri,onChange:e=>setMavitri(e.target.value),children:locations.length>0?locations.map(loc=>/*#__PURE__*/_jsxs(\"option\",{value:loc.mavitri,children:[loc.mavitri,\" (S\\u1ED1 l\\u01B0\\u1EE3ng c\\xF3 th\\u1EC3 m\\u01B0\\u1EE3n: \",loc.soluong-loc.soluongmuon,\")\"]},loc.mavitri)):/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Kh\\xF4ng c\\xF3 v\\u1ECB tr\\xED n\\xE0o\"})}),/*#__PURE__*/_jsx(\"label\",{children:\"M\\xE3 V\\u1ECB Tr\\xED\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-floating mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"form-control\",value:ngaymuon,onChange:e=>setNgaymuon(e.target.value),min:new Date().toISOString().split('T')[0]// Prevent past dates\n}),/*#__PURE__*/_jsx(\"label\",{children:\"Ng\\xE0y M\\u01B0\\u1EE3n\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-floating mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"form-control\",min:\"1\",value:quantity,onChange:e=>setQuantity(Math.max(1,parseInt(e.target.value)))}),/*#__PURE__*/_jsx(\"label\",{children:\"S\\u1ED1 L\\u01B0\\u1EE3ng\"})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"\\u0110\\xF3ng\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleRequestBook,children:\"G\\u1EEDi Y\\xEAu C\\u1EA7u\"})]})]})]});}export default ModalRequestBook;","map":{"version":3,"names":["useState","useEffect","Button","Modal","request","ToastContainer","toast","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ModalRequestBook","_ref","show","setShow","masach","tensach","vitri","handleClose","quantity","setQuantity","ngaymuon","setNgaymuon","mavitri","setMavitri","locations","setLocations","today","Date","toISOString","split","Array","isArray","_vitri$","error","toastOptions","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","onClose","handleRequestBook","_document$cookie$spli","token","document","cookie","find","row","startsWith","books","soluong","parseInt","res","post","headers","Authorization","data","message","success","_error$response","_error$response$data","errorMessage","response","children","onHide","Header","closeButton","Title","Body","className","value","disabled","onChange","e","target","length","map","loc","soluongmuon","type","min","Math","max","Footer","variant","onClick"],"sources":["E:/Documents/Hoc_Tap/LATN/client/src/Page/HomePage/Layouts/Main/Modal/ModalRequestBook.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Modal from 'react-bootstrap/Modal';\r\nimport request from '../../../../../config/Connect';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nfunction ModalRequestBook({ show, setShow, masach, tensach, vitri }) {\r\n    const handleClose = () => setShow(false);\r\n    const [quantity, setQuantity] = useState(1);\r\n    const [ngaymuon, setNgaymuon] = useState('');\r\n    const [mavitri, setMavitri] = useState('');\r\n    const [locations, setLocations] = useState([]);\r\n\r\n\r\n    // Set default borrow date to today\r\n    useEffect(() => {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        setNgaymuon(today);\r\n    }, []);\r\n\r\n    // Update locations and default mavitri when modal opens\r\n    useEffect(() => {\r\n        if (show && vitri && Array.isArray(vitri)) {\r\n            setLocations(vitri);\r\n            setMavitri(vitri[0]?.mavitri || '');\r\n        } else if (show) {\r\n            toast.error('Không có thông tin vị trí sách!');\r\n            setLocations([]);\r\n            setMavitri('');\r\n        }\r\n    }, [show, vitri]);\r\n\r\n    const toastOptions = {\r\n        position: 'top-right',\r\n        autoClose: 1000,\r\n        hideProgressBar: false,\r\n        closeOnClick: true,\r\n        pauseOnHover: true,\r\n        draggable: true,\r\n        progress: undefined,\r\n        onClose: handleClose,\r\n    };\r\n\r\n    const handleRequestBook = async () => {\r\n        const token = document.cookie\r\n            .split('; ')\r\n            .find(row => row.startsWith('token='))\r\n            ?.split('=')[1];\r\n        if (!token) {\r\n            toast.error('Không có token, vui lòng đăng nhập lại!', toastOptions);\r\n            return;\r\n        }\r\n        try {\r\n            const books = [{\r\n                masach,\r\n                mavitri,\r\n                soluong: parseInt(quantity),\r\n            }];\r\n            const res = await request.post(\r\n                '/api/requestborrowbook',\r\n                {\r\n                    books,\r\n                    ngaymuon,\r\n                },\r\n                {\r\n                    headers: {\r\n                        Authorization: `Bearer ${token}`,\r\n                    },\r\n                }\r\n            );\r\n            if (res.data.message === 'Yêu cầu mượn sách thành công !!!') {\r\n                toast.success('Yêu cầu mượn sách thành công!', toastOptions);\r\n            } else {\r\n                toast.error(res.data.message, toastOptions);\r\n            }\r\n        } catch (error) {\r\n            const errorMessage = error.response?.data?.message || 'Có lỗi xảy ra khi mượn sách!';\r\n            toast.error(errorMessage, toastOptions);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <ToastContainer />\r\n            <Modal show={show} onHide={handleClose}>\r\n                <Modal.Header closeButton>\r\n                    <Modal.Title>Yêu Cầu Mượn Sách</Modal.Title>\r\n                </Modal.Header>\r\n                <Modal.Body>\r\n                    <div className=\"form-floating mb-3\">\r\n                        <input value={masach || ''} className=\"form-control\" disabled />\r\n                        <label>Mã Sách</label>\r\n                    </div>\r\n                    <div className=\"form-floating mb-3\">\r\n                        <input value={tensach || ''} className=\"form-control\" disabled />\r\n                        <label>Tên Sách</label>\r\n                    </div>\r\n                    <div className=\"form-floating mb-3\">\r\n                        <select\r\n                            className=\"form-control\"\r\n                            value={mavitri}\r\n                            onChange={(e) => setMavitri(e.target.value)}\r\n                        >\r\n                            {locations.length > 0 ? (\r\n                                locations.map((loc) => (\r\n                                    <option key={loc.mavitri} value={loc.mavitri}>\r\n                                        {loc.mavitri} (Số lượng có thể mượn: {loc.soluong - loc.soluongmuon})\r\n                                    </option>\r\n                                ))\r\n                            ) : (\r\n                                <option value=\"\">Không có vị trí nào</option>\r\n                            )}\r\n                        </select>\r\n                        <label>Mã Vị Trí</label>\r\n                    </div>\r\n                    <div className=\"form-floating mb-3\">\r\n                        <input\r\n                            type=\"date\"\r\n                            className=\"form-control\"\r\n                            value={ngaymuon}\r\n                            onChange={(e) => setNgaymuon(e.target.value)}\r\n                            min={new Date().toISOString().split('T')[0]} // Prevent past dates\r\n                        />\r\n                        <label>Ngày Mượn</label>\r\n                    </div>\r\n                    <div className=\"form-floating mb-3\">\r\n                        <input\r\n                            type=\"number\"\r\n                            className=\"form-control\"\r\n                            min=\"1\"\r\n                            value={quantity}\r\n                            onChange={(e) => setQuantity(Math.max(1, parseInt(e.target.value)))}\r\n                        />\r\n                        <label>Số Lượng</label>\r\n                    </div>\r\n                </Modal.Body>\r\n                <Modal.Footer>\r\n                    <Button variant=\"secondary\" onClick={handleClose}>\r\n                        Đóng\r\n                    </Button>\r\n                    <Button variant=\"primary\" onClick={handleRequestBook}>\r\n                        Gửi Yêu Cầu\r\n                    </Button>\r\n                </Modal.Footer>\r\n            </Modal>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default ModalRequestBook;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}